(function(L,P){typeof exports=="object"&&typeof module<"u"?P(exports):typeof define=="function"&&define.amd?define(["exports"],P):(L=typeof globalThis<"u"?globalThis:L||self,P(L["tiny-table"]={}))})(this,(function(L){"use strict";const P="tiny-table";function ft(s){const t=document.createDocumentFragment();return s.forEach(e=>{let r;e instanceof G?r=e._:typeof e=="string"?r=document.createTextNode(e):r=e,t.appendChild(r)}),t}class G{_;_data=new Map;constructor(t,e){if(this._=t instanceof Node?t:document.createElement(t),e)if(typeof e=="string")this._.className=e;else if(Array.isArray(e))this._.className=e.join(" ");else for(let[r,i]of Object.entries(e))i&&this._.classList.add(r)}element(){return this._}data(t,e){return e?(this._data.set(t,e),this):this._data.get(t)}on(t,e){const[r,...i]=t.split(".");return this._.addEventListener(r,e),this}off(t,e){return this._.removeEventListener(t,e),this}focus(){return this._.focus(),this}value(t){return t!==void 0?(this._.value=t,this):this._.value}textContent(t){return this._.textContent=t,this}html(t){return this._.innerHTML=t,this}addClass(...t){return this._.classList.add(...t),this}removeClass(...t){return this._.classList.remove(...t),this}toggleClass(t){const{classList:e}=this._;return e.contains(t)?e.remove(t):e.add(t),this}attr(t,e){return e?(this._.setAttribute(t,e),this):this._.getAttribute(t)}css(t,e){const{style:r}=this._;return e?(r.setProperty(t,e),this):typeof t=="string"?r.getPropertyValue(t):(Object.keys(t).forEach(i=>{let o=t[i];typeof o=="number"&&(o=`${o}px`),r.setProperty(i,o)}),this)}rect(){return this._.getBoundingClientRect()}offset(){const{_:t}=this;return{x:t.offsetLeft,y:t.offsetTop,width:t.offsetWidth,height:t.offsetHeight}}computedStyle(){return window.getComputedStyle(this._)}show(t=!0){return this.css("display",t?"block":"none"),this}hide(){return this.css("display","none"),this}scrollx(t){const{_:e}=this;return t!==void 0?(e.scrollLeft=t,this):e.scrollLeft}scrolly(t){const{_:e}=this;return t!==void 0?(e.scrollTop=t,this):e.scrollTop}after(...t){return this._.after(ft(t)),this}before(...t){return this._.before(ft(t)),this}append(...t){return this._.append(ft(t)),this}remove(...t){t.forEach(e=>{this._.removeChild(e instanceof G?e._:e)})}contains(t){return this._.contains(t)}cloneNode(){return this._.cloneNode(!0)}get firstChild(){const t=this._.firstChild;return t?new G(t):null}}function z(s,t){return new G(s,t)}function B(){return z("div",`${P}-overlayer-area`)}class Kt{_areas;_headerAreas;_areaRects=[];constructor(t){this._areas=[B(),B(),B(),B()],this._headerAreas=[B(),B(),B(),B()],t.append(...this._areas,...this._headerAreas)}area(t,e){if(e){this._areaRects[t]=e;const{x:r,y:i,height:o,width:n}=e;return this._areas[t].css({left:r,top:i,width:n,height:o}),this}return this._areas[t]}headerArea(t,e){if(e){const{x:r,y:i,height:o,width:n}=e;this._headerAreas[t].css({left:r,top:i,width:n,height:o})}return this._headerAreas[t]}inAreas({x:t,y:e,height:r,width:i}){const o=t+i,n=e+r;for(let l of this._areaRects)if(t>=0&&o<=l.width&&e>=0&&n<=l.height)return!0;return!1}}const ut="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function Gt(s){return ut.charAt(s%ut.length)}function pt(s){const t=[];for(;s>=0;)t.push(Gt(s)),s=parseInt(s/ut.length+"",10)-1;return t.reverse().join("")}function qt(s){let t=0;for(let e=0;e<s.length;e++)t=26*t+s.charCodeAt(e)-64;return t-1}function q(s){let t="",e="";for(let r=0;r<s.length;r+=1)s.charAt(r)>="0"&&s.charAt(r)<="9"?e+=s.charAt(r):t+=s.charAt(r).toUpperCase();return[qt(t),parseInt(e,10)-1]}function tt(s,t){return`${pt(s)}${t+1}`}function Rt(s,t,e){const[r,i]=q(s);return tt(r+t,i+e)}class Xt{constructor(t,e){this.target=t;const r=t.getContext("2d");if(!r)throw new Error("getContext(2d) is null");this._ctx=r,this._scale=e,this._target=t}_target;_ctx;_scale;size(t,e){const{_target:r,_scale:i}=this;r.style.width=`${t}px`,r.style.height=`${e}px`;const o=window.devicePixelRatio;return r.width=Math.floor(t*o),r.height=Math.floor(e*o),this._ctx.scale(o*i,o*i),this}prop(t,e){return e?(this._ctx[t]=e,this):typeof t=="string"?this._ctx[t]:(Object.entries(t).forEach(([r,i])=>{i!=null&&(this._ctx[r]=i)}),this)}measureTextWidth(t){return this.measureText(t).width}line(t,e,r,i){return this.moveTo(t,e).lineTo(r,i).stroke(),this}clearRect(t,e,r,i){return this._ctx.clearRect(t,e,r,i),this}fillRect(t,e,r,i){return this._ctx.fillRect(t,e,r,i),this}strokeRect(t,e,r,i){return this._ctx.strokeRect(t,e,r,i),this}fillText(t,e,r,i){return this._ctx.fillText(t,e,r,i),this}strokeText(t,e,r,i){return this._ctx.strokeText(t,e,r,i),this}measureText(t){return this._ctx.measureText(t)}getLineDash(){return this._ctx.getLineDash()}setLineDash(t){return this._ctx.setLineDash(t),this}createLinearGradient(t,e,r,i){return this._ctx.createLinearGradient(t,e,r,i)}createRadialGradient(t,e,r,i,o,n){return this._ctx.createRadialGradient(t,e,r,i,o,n)}createPattern(t,e){return this._ctx.createPattern(t,e)}beginPath(){return this._ctx.beginPath(),this}closePath(){return this._ctx.closePath(),this}moveTo(t,e){return this._ctx.moveTo(t,e),this}lineTo(t,e){return this._ctx.lineTo(t,e),this}bezierCurveTo(t,e,r,i,o,n){return this._ctx.bezierCurveTo(t,e,r,i,o,n),this}quadraticCurveTo(t,e,r,i){return this._ctx.quadraticCurveTo(t,e,r,i),this}arc(t,e,r,i,o,n){return this._ctx.arc(t,e,r,i,o,n),this}arcTo(t,e,r,i,o){return this._ctx.arcTo(t,e,r,i,o),this}ellipse(t,e,r,i,o,n,l,h){return this._ctx.ellipse(t,e,r,i,o,n,l,h),this}rect(t,e,r,i){return this._ctx.rect(t,e,r,i),this}roundRect(t,e,r,i,o){return this.beginPath().moveTo(t+o,e).arcTo(t+r,e,t+r,e+i,o).arcTo(t+r,e+i,t,e+i,o).arcTo(t,e+i,t,e,o).arcTo(t,e,t+r,e,o).closePath(),this}fill(t){return this._ctx.fill(t),this}stroke(){return this._ctx.stroke(),this}clip(t){return this._ctx.clip(t),this}isPointInPath(t,e,r){return this._ctx.isPointInPath(t,e,r)}isPointInStroke(t,e){return this._ctx.isPointInStroke(t,e)}getTransform(){return this._ctx.getTransform()}rotate(t){return this._ctx.rotate(t),this}scale(t,e){return this._ctx.scale(t,e),this}translate(t,e){return this._ctx.translate(t,e),this}setTransform(t,e,r,i,o,n){return this._ctx.setTransform(t,e,r,i,o,n),this}drawImage(t,e,r){return this._ctx.drawImage(t,e,r),this}createImageData(t,e){return this._ctx.createImageData(t,e)}getImageData(t,e,r,i){return this._ctx.getImageData(t,e,r,i)}putImageData(t,e,r){return this._ctx.putImageData(t,e,r),this}save(){return this._ctx.save(),this}restore(){return this._ctx.restore(),this}}class v{constructor(t,e,r,i){this.startRow=t,this.startCol=e,this.endRow=r,this.endCol=i}get start(){return[this.startRow,this.startCol]}get end(){return[this.endRow,this.endCol]}get rows(){return this.endRow-this.startRow}get cols(){return this.endCol-this.startCol}get multiple(){return this.cols>0||this.rows>0}containsRow(t){return this.startRow<=t&&t<=this.endRow}containsCol(t){return this.startCol<=t&&t<=this.endCol}contains(t,e){return this.containsRow(t)&&this.containsCol(e)}within(t){return this.startRow>=t.startRow&&this.startCol>=t.startCol&&this.endRow<=t.endRow&&this.endCol<=t.endCol}position(t){if(this.startRow<=t.startRow&&this.endRow>=t.endRow){if(t.startCol>this.endCol)return"right";if(t.endCol<this.startCol)return"left"}else if(this.startCol<=t.startCol&&this.endCol>=t.endCol){if(t.startRow>this.endRow)return"down";if(t.endRow<this.startRow)return"up"}return"none"}intersectsRow(t,e){return this.startRow<=e&&t<=this.endRow}intersectsCol(t,e){return this.startCol<=e&&t<=this.endCol}intersects({startRow:t,startCol:e,endRow:r,endCol:i}){return this.intersectsCol(e,i)&&this.intersectsRow(t,r)}intersection(t){return new v(t.startRow<this.startRow?this.startRow:t.startRow,t.startCol<this.startCol?this.startCol:t.startCol,t.endRow>this.endRow?this.endRow:t.endRow,t.endCol>this.endCol?this.endCol:t.endCol)}union(t){return new v(t.startRow<this.startRow?t.startRow:this.startRow,t.startCol<this.startCol?t.startCol:this.startCol,t.endRow>this.endRow?t.endRow:this.endRow,t.endCol>this.endCol?t.endCol:this.endCol)}difference(t){const e=[];if(!this.intersects(t))return e;const{startRow:r,startCol:i,endRow:o,endCol:n}=this,l=this.intersection(t);return[new v(r,i,l.startRow-1,n),new v(l.endRow+1,i,o,n),new v(l.startRow,i,l.endRow,l.startCol-1),new v(l.startRow,l.endCol+1,l.endRow,n)].filter(h=>h.rows>=0&&h.cols>=0)}touches(t){return t.startRow===this.startRow&&t.endRow===this.endRow&&(t.endCol+1===this.startCol||this.endCol+1===t.startCol)||t.startCol===this.startCol&&t.endCol===this.endCol&&(t.endRow+1===this.startRow||this.endRow+1===this.startCol)}eachRow(t,e){let{endRow:r}=this;e&&r>e&&(r=e);for(let i=this.startRow;i<=r;i+=1)t(i);return this}eachCol(t,e){let{endCol:r}=this;e&&r>e&&(r=e);for(let i=this.startCol;i<=r;i+=1)t(i);return this}each(t){return this.eachRow(e=>{this.eachCol(r=>t(e,r))}),this}clone(){return new v(this.startRow,this.startCol,this.endRow,this.endCol)}toString(){let t=tt(this.startCol,this.startRow);return this.multiple&&(t+=`:${tt(this.endCol,this.endRow)}`),t}equals(t){return this.startRow===t.startRow&&this.startCol===t.startCol&&this.endRow===t.endRow&&this.endCol===t.endCol}static create(t,e,r,i){if(r!==void 0&&i!==void 0){let[o,n,l,h]=[t,e,r,i];return t>r&&(o=r,l=t),e>i&&(n=i,h=e),new v(o,n,l,h)}return new v(t,e,t,e)}static with(t){const e=t.split(":"),[r,i]=q(e[0]);if(e.length===1)return this.create(i,r);const[o,n]=q(e[1]);return this.create(i,r,n,o)}}function Yt(s,t){s&&s.length>0&&s.forEach(e=>{t(v.with(e))})}function Nt(s,t,e){switch(s){case"left":return e;case"center":return t/2;case"right":return t-e;default:return 0}}function Qt(s,t,e,r,i){switch(s){case"top":return i;case"middle":let o=t/2-e/2;const n=r/2+i;return o<n?n:o;case"bottom":return t-i-e;default:return 0}}function Ut(s,t,e,r,i,o,n){let l=0;s==="underline"?e==="top"?l=-n:e==="middle"&&(l=-n/2):s==="strikethrough"&&(e==="top"?l=-n/2:e==="bottom"&&(l=n/2));let h=0;return t==="center"?h=o/2:t==="right"&&(h=o),[r-h,i-l,r-h+o,i-l]}function Zt(s,t,e,r){if(s&&t){let i="";return e&&(i+="italic "),r&&(i+="bold "),`${i} ${t}pt ${s}`}}function D(s,t,e,r=!1){let i,o,n,l;Array.isArray(e)?i=o=n=l=e:{top:i,right:o,bottom:n,left:l}=e,s.save().beginPath().translate(t.x,t.y);const h=(a,c)=>[[0-c,0,t.width+c,0],[t.width,0,t.width,t.height],[0-c,t.height,t.width+c,t.height],[0,0,0,t.height]][a];[i,o,n,l].forEach((a,c)=>{if(a){let d=[],u=1;a[0]==="thick"?u=3:a[0]==="medium"?u=2:a[0]==="dotted"?d=[1,1]:a[0]==="dashed"&&(d=[2,2]);let w=0;r&&(w=u/2),s.prop({strokeStyle:a[1],lineWidth:u}).setLineDash(d).line(...h(c,w))}}),s.restore()}function yt(s,t,e,r,i,o){let n="";t&&(typeof t=="string"||typeof t=="number"?n=o(`${t}`):n=o((t.value||"")+"",t.format));const{fontSize:l,fontFamily:h,bold:a,italic:c,color:d,bgcolor:u,align:w,valign:f,underline:_,strikethrough:C,rotate:R,textwrap:p,padding:A}=r;if(s.save().beginPath().translate(e.x,e.y),s.rect(0,0,e.width,e.height).clip(),u&&s.prop("fillStyle",u).fill(),R&&R>0&&s.rotate(R*(Math.PI/180)),i!==void 0){if(s.save(),!i(s,e,t,n)){s.restore();return}s.restore()}if(n&&!/^\s*$/.test(n)){s.save().beginPath().prop({textAlign:w,textBaseline:f,font:Zt(h,l,c,a),fillStyle:d});const[m,y]=A||[5,5],x=Nt(w,e.width,m),H=n.split(`
`),b=e.width-m*2,S=[];H.forEach(g=>{const M=s.measureTextWidth(g);if(p&&M>b){let T={w:0,len:0,start:0};for(let Q=0;Q<g.length;Q+=1)T.w>b&&(S.push(g.substr(T.start,T.len)),T={w:0,len:0,start:Q}),T.len+=1,T.w+=s.measureTextWidth(g[Q])+1;T.len>0&&S.push(g.substr(T.start,T.len))}else S.push(g)});const W=l/.75,E=(S.length-1)*W,k=[];_&&k.push("underline"),C&&k.push("strikethrough");let O=Qt(f,e.height,E,W,y);S.forEach(g=>{const M=s.measureTextWidth(g);s.fillText(g,x,O),k.forEach(T=>{s.line(...Ut(T,w,f,x,O,M,l))}),O+=W}),s.restore()}s.restore()}function Ct(s,[t,e,...r],i){const o=[],n=v.with(t),l=i.filter(h=>h.intersects(n));if(n.intersects(s.range)||l.length>0)if(l.length<=0)o.push([n,s.rect(n),e]);else for(let h of l)if(n.within(h))n.startRow===h.startRow&&n.startCol===h.startCol&&e!=="inside"&&e!=="horizontal"&&e!=="vertical"&&o.push([h,s.rect(h),e==="all"?"outside":e]);else if(e==="outside"||e==="left"||e==="top"||e==="right"||e==="bottom"){o.push([n,s.rect(n),e]);break}else{const a=l.filter(c=>!c.equals(h));if(n.difference(h).forEach(c=>{if(c.intersects(s.range)){const d=s.rect(c);o.push(...Ct(s,[c.toString(),e,...r],a)),(e==="inside"||e==="horizontal")&&(c.startRow<h.startRow&&c.endRow<h.startRow?o.push([c,d,"bottom"]):c.startRow>h.startRow&&c.endRow>h.startRow&&o.push([c,d,"top"])),(e==="inside"||e==="vertical")&&(c.startCol<h.startCol&&c.endCol<h.startCol&&o.push([c,d,"right"]),c.startCol>h.startCol&&c.endCol>h.startCol&&o.push([c,d,"left"]))}}),e==="all"){const c=s.rect(h);n.startRow===h.startRow&&o.push([h,c,"top"]),n.endRow===h.endRow&&o.push([h,c,"bottom"]),n.startCol===h.startCol&&o.push([h,c,"left"]),n.endCol===h.endCol&&o.push([h,c,"right"])}break}return o}function dt(s,{width:t,color:e},r){t>0&&(s.save().beginPath().prop({lineWidth:t-.5,strokeStyle:e}),r(),s.restore())}function mt(s,t,{x:e,y:r,width:i,height:o}){dt(s,t,()=>{s.translate(e,r).line(i,0,i,o).line(0,o,i,o)})}function Jt(s,t,e,r,i,o,n,l){const h=[o,n];i==="outside"||i==="all"?D(s,r,h,!0):i==="left"?D(s,r,{left:h},l):i==="top"?D(s,r,{top:h},l):i==="right"?D(s,r,{right:h},l):i==="bottom"&&D(s,r,{bottom:h},l),(i==="all"||i==="inside"||i==="horizontal"||i==="vertical")&&(i!=="horizontal"&&e.eachCol(a=>{if(a<e.endCol){const c=e.clone();c.endCol=c.startCol=a,c.intersects(t.range)&&D(s,t.rect(c),{right:h},l)}}),i!=="vertical"&&e.eachRow(a=>{if(a<e.endRow){const c=e.clone();c.endRow=c.startRow=a,c.intersects(t.range)&&D(s,t.rect(c),{bottom:h},l)}}))}function te(s,t,e,r){e&&e.length>0&&e.forEach(i=>{const[,,o,n]=i;Ct(t,i,r).forEach(([l,h,a])=>{Jt(s,t,l,h,a,o,n)})})}function V(s,t,e,r){if(!e)return;let i,o,n=y=>y,l=r._headerStyle,h=r._headerGridline,a=r._styles,c,d,u,w;const{_rowHeader:f,_colHeader:_}=r;if(s==="row-header"){if(f.width<=0)return;({cell:i,merges:c,cellRenderer:o}=f)}else if(s==="col-header"){if(_.height<=0)return;({cell:i,merges:c,cellRenderer:o}=_)}else i=r._cell,o=r._cellRenderer,n=r._formatter,l=r._style,h=r._gridline,a=r._styles,c=r._merges,d=r._borders,u=r._row,w=r._col;t.save().translate(e.x,e.y).prop("fillStyle",r._bgcolor).rect(0,0,e.width,e.height).fill().clip();const C=(y,x,H)=>{const b={...l};if(u){const S=u(y);S&&S.style!==void 0&&Object.assign(b,a[S.style])}if(w){const S=w(x);S&&S.style!==void 0&&Object.assign(b,a[S.style])}return H instanceof Object&&H.style!==void 0&&Object.assign(b,a[H.style]),b},R=[],p=[],A=new Set;c&&Yt(c,y=>{if(y.intersects(e.range)){const x=i(y.startRow,y.startCol),H=C(y.startRow,y.startCol,x),b=e.rect(y);p.push([x,b,H]),R.push(y),y.each((S,W)=>{A.add(`${S}_${W}`)})}});const m=(y,x,H)=>{s==="body"?(mt(t,h,x),yt(t,y,x,H,o,n)):(yt(t,y,x,H,o,n),mt(t,h,x))};e.each((y,x,H)=>{if(!A.has(`${y}_${x}`)){const b=i(y,x);m(b,H,C(y,x,b))}}),p.forEach(y=>m(...y)),te(t,e,d,R),t.restore()}function ee(s){const{_width:t,_height:e,_target:r,_scale:i,_viewport:o,_freeze:n,_rowHeader:l,_colHeader:h}=s;if(o){const a=new Xt(r,i);a.size(t,e);const[c,d,u,w]=o.areas,[f,_,C,R]=o.headerAreas;V("body",a,w,s),V("body",a,c,s),V("col-header",a,f,s),V("body",a,u,s),V("row-header",a,R,s),V("body",a,d,s),V("col-header",a,_,s),V("row-header",a,C,s);const[p,A]=n;(A>0||p>0)&&dt(a,s._freezeGridline,()=>{A>0&&a.line(0,w.y,t,w.y),p>0&&a.line(w.x,0,w.x,e)});const{x:m,y}=d;if(m>0&&y>0){const{height:x}=h,{width:H}=l,{bgcolor:b}=s._headerStyle;b&&a.save().prop({fillStyle:b}).rect(0,0,H,x).fill().restore(),dt(a,s._headerGridline,()=>{a.line(0,x,H,x).line(H,0,H,x)})}}}class j{constructor(t,e,r,i,o,n,l){this.range=t,this.x=e,this.y=r,this.width=i,this.height=o,this.rowHeight=n,this.colWidth=l;let h=0;t.eachRow(c=>{const d=n(c);this.rowMap.set(c,{y:h,height:d}),h+=d}),this.height<=0&&(this.height=h);let a=0;t.eachCol(c=>{const d=l(c);this.colMap.set(c,{x:a,width:d}),a+=d}),this.width<=0&&(this.width=a)}rowMap=new Map;colMap=new Map;containsx(t){return t>=this.x&&t<this.x+this.width}containsy(t){return t>=this.y&&t<this.y+this.height}contains(t,e){return this.containsx(t)&&this.containsy(e)}eachRow(t){this.range.eachRow(e=>{const{y:r,height:i}=this.rowMap.get(e)||{y:0,height:0};i>0&&t(e,r,i)})}eachCol(t){this.range.eachCol(e=>{const{x:r,width:i}=this.colMap.get(e)||{x:0,width:0};i>0&&t(e,r,i)})}each(t){this.eachRow((e,r,i)=>{this.eachCol((o,n,l)=>{t(e,o,{x:n,y:r,width:l,height:i})})})}rectRow(t,e){const{rowMap:r,range:i}=this;let[o,n]=[0,0];t>=i.startRow&&(o=r.get(t)?.y||0);for(let h=t;h<=e;h+=1){const a=this.rowHeight(h);a>0&&(h<i.startRow&&(o-=a),n+=a)}const{width:l}=this;return{x:0,y:o,width:l,height:n}}rectCol(t,e){const{colMap:r,range:i}=this;let[o,n]=[0,0];t>=i.startCol&&(o=r.get(t)?.x||0);for(let h=t;h<=e;h+=1){const a=this.colWidth(h);a>0&&(h<i.startCol&&(o-=a),n+=a)}const{height:l}=this;return{x:o,y:0,width:n,height:l}}rect(t){let{y:e,height:r}=this.rectRow(t.startRow,t.endRow),{x:i,width:o}=this.rectCol(t.startCol,t.endCol);return{x:i,y:e,width:o,height:r}}cellAtCache=null;cellAt(t,e){const{cellAtCache:r}=this;if(r!=null&&t>r.x&&t<=r.x+r.width&&e>r.y&&e<=r.y+r.height)return r;const{startRow:i,startCol:o}=this.range,n={row:i,col:o,x:this.x,y:this.y,width:0,height:0};for(;n.y<e;){const l=this.rowHeight(n.row++);n.y+=l,n.height=l}for(n.y-=n.height,n.row--;n.x<t;){const l=this.colWidth(n.col++);n.x+=l,n.width=l}return n.x-=n.width,n.col--,this.cellAtCache=n,n}static create(t,e,r,i,o,n,l,h,a,c){return new j(new v(t,e,r,i),o,n,l,h,a,c)}}class re{areas;headerAreas;_render;constructor(t){this._render=t;const[e,r]=[t._rowHeader.width,t._colHeader.height],[i,o]=t._freeze,{_startRow:n,_startCol:l,_rows:h,_cols:a,_width:c,_height:d}=t,u=T=>t.rowHeightAt(T),w=T=>t.colWidthAt(T),f=j.create(n,l,i-1,o-1,e,r,0,0,u,w),[_,C]=[i+t._scrollRows,o+t._scrollCols];let R=f.height+r,p=_;for(;R<d&&p<h;)R+=u(p),p+=1;let A=f.width+e,m=C;for(;A<c&&m<a;)A+=w(m),m+=1;const y=e+f.width,x=r+f.height;let H=c-y,b=d-x;m===a&&(H-=c-A),p===h&&(b-=d-R),m-=1,p-=1;const S=j.create(_,C,p,m,y,x,H,b,u,w),W=j.create(n,C,i-1,m,y,r,H,0,u,w),E=j.create(_,l,p,o-1,e,x,0,b,u,w);this.areas=[W,f,E,S];const{_rowHeader:k,_colHeader:O}=t,g=()=>O.height/O.rows,M=()=>k.width/k.cols;this.headerAreas=[j.create(0,W.range.startCol,O.rows-1,W.range.endCol,S.x,0,S.width,0,g,w),j.create(0,f.range.startCol,O.rows-1,f.range.endCol,f.x,0,f.width,0,g,w),j.create(f.range.startRow,0,f.range.endRow,k.cols-1,0,f.y,0,f.height,u,M),j.create(E.range.startRow,0,E.range.endRow,k.cols-1,0,S.y,0,S.height,u,M)]}inAreas(t,e){for(let r of this.areas)if(r.range.contains(t,e))return!0;return!1}cellAt(t,e){const r=this.areas[1],[i,o,n,l]=this.headerAreas;if(t<r.x&&e<r.y)return{placement:"all",row:0,col:0,x:0,y:0,width:r.x,height:r.y};if(t<r.x)return{placement:"row-header",...(n.containsy(e)?n:l).cellAt(t,e)};if(e<r.y)return{placement:"col-header",...(o.containsx(t)?o:i).cellAt(t,e)};for(let h of this.areas)if(h.contains(t,e))return{placement:"body",...h.cellAt(t,e)};return null}}class et{_target;_bgcolor="#ffffff";_width=0;_height=0;_scale=1;_rows=100;_cols=26;_rowHeight=22;_colWidth=100;_startRow=0;_startCol=0;_scrollRows=0;_scrollCols=0;_row=()=>{};_col=()=>{};_cell=()=>{};_cellRenderer=()=>!0;_formatter=t=>t;_merges=[];_borders=[];_styles=[];_gridline={width:1,color:"#e6e6e6"};_style={align:"left",valign:"middle",textwrap:!1,underline:!1,strikethrough:!1,color:"#0a0a0a",bold:!1,italic:!1,rotate:0,fontSize:10,fontFamily:"Source Sans Pro"};_rowHeader={width:60,cols:1,cell(t,e){return t+1}};_colHeader={height:24,rows:1,cell(t,e){return pt(e)}};_headerGridline={width:1,color:"#e6e6e6"};_headerStyle={bgcolor:"#f4f5f8cc",align:"center",valign:"middle",textwrap:!0,underline:!1,strikethrough:!1,color:"#585757",bold:!1,italic:!1,rotate:0,fontSize:10,fontFamily:"Source Sans Pro"};_freeze=[0,0];_freezeGridline={width:2,color:"#d8d8d8"};_viewport=null;constructor(t,e,r){const i=typeof t=="string"?document.querySelector(t):t;if(!i)throw new Error("target error");this._target=i,this._width=e,this._height=r}render(){return this._viewport=new re(this),ee(this),this}bgcolor(t){return this._bgcolor=t,this}width(t){return this._width=t,this}height(t){return this._height=t,this}scale(t){return this._scale=t,this}rows(t){return this._rows=t,this}cols(t){return this._cols=t,this}rowHeight(t){return this._rowHeight=t,this}colWidth(t){return this._colWidth=t,this}startRow(t){return this._startRow=t,this}startCol(t){return this._startCol=t,this}scrollRows(t){return this._scrollRows=t,this}scrollCols(t){return this._scrollCols=t,this}row(t){return this._row=t,this}col(t){return this._col=t,this}cell(t){return this._cell=t,this}cellRenderer(t){return this._cellRenderer=t,this}formatter(t){return this._formatter=t,this}merges(t){return this._merges=t,this}styles(t){return this._styles=t,this}borders(t){return this._borders=t,this}gridline(t){return t&&Object.assign(this._gridline,t),this}style(t){return t&&Object.assign(this._style,t),this}rowHeader(t){return t&&Object.assign(this._rowHeader,t),this}colHeader(t){return t&&Object.assign(this._colHeader,t),this}headerGridline(t){return t&&Object.assign(this._headerGridline,t),this}headerStyle(t){return t&&Object.assign(this._headerStyle,t),this}freeze(t){return t&&(this._freeze=q(t).reverse()),this}freezeGridline(t){return t&&Object.assign(this._freezeGridline,t),this}rowHeightAt(t){const{_row:e}=this;if(e){const r=e(t);if(r)return r.hide===!0?0:r.height}return this._rowHeight}colWidthAt(t){const{_col:e}=this;if(e){const r=e(t);if(r)return r.hide===!0?0:r.width}return this._colWidth}get viewport(){return this._viewport}static create(t,e,r){return new et(t,e,r)}}try{window&&(window.tiny||={},window.tiny.table_renderer=et.create)}catch{}class se{_=[];_indexes=new Map;_formulas=[];_formulaParser=t=>t;_formatter=t=>t;constructor(){}formulaParser(t){return this._formulaParser=t,this}formatter(t){return this._formatter=t,this}load({cells:t}){t&&(this._=t,this.resetIndexes())}get(t,e){const{_indexes:r}=this;if(r.has(t)){const i=r.get(t).get(e);return i!==void 0?this._[i]:null}return null}remove(t,e){const{_indexes:r}=this;if(r.has(t)){const i=r.get(t),o=i.get(e);o!==void 0&&(this._.splice(o,1),i.delete(e))}return this}set(t,e,r){let i=this.get(t,e);if(i===null){if(r!=null){const o=this._.push([t,e,r])-1;this.updateIndex(t,e,o),this.addFormula(r,o)}}else{const o=i[2],n=U(o),l=U(r);l===""?(o instanceof Object&&Object.keys(o).length>1?delete o.value:this.remove(t,e),this.resetFormulas()):(o instanceof Object?Object.assign(o,r instanceof Object?r:{value:r}):i[2]=r,l!==n&&this.resetFormulas())}}resetIndexes(){const{_:t}=this;for(let e=0;e<t.length;e+=1){const[r,i,o]=t[e];this.updateIndex(r,i,e),this.addFormula(o,e)}}updateIndex(t,e,r){const{_indexes:i}=this;i.has(t)||i.set(t,new Map),i.get(t).set(e,r)}addFormula(t,e){t instanceof Object&&t.formula&&(t.value=this._formulaParser(t.formula),this._formulas.push(e))}resetFormulas(){this._formulas.forEach(t=>{const[,,e]=this._[t];e instanceof Object&&e.formula&&(e.value=this._formulaParser(e.formula))})}}function bt(s){return s instanceof Object?s.value:s}function U(s){const t=bt(s);return`${t??""}`}function vt(s,t,e,r,i){const{scroll:o}=s,n=r==="row"?0:1,l=r==="row"?3:2;let h=o[l],a=!1,c=o[n],d=0;const{freeze:u}=s;if(u&&(d=q(u)[r==="row"?1:0]),e>0)if(t==="+")for(let w=c;!(h>=e);w+=1){const f=i(d+w);h+=f,s.scroll[n]=w+1,a=!0}else for(let w=c;!(h<=e);w-=1){const f=i(d+w-1);if(h-=f,s.scroll[n]=w-1,a=!0,f>0)break}else s.scroll[n]=0,h=0,a=!0;return o[l]=h,a}function ie(s,t,e){return t&&e!==void 0?vt(s,t,e,"col",r=>X(s,r).width):s.scroll[2]}function oe(s,t,e){return t&&e!==void 0?vt(s,t,e,"row",r=>Y(s,r).height):s.scroll[3]}function xt({merges:s},t){if(s){const e=v.with(t);for(let r=0;r<s.length;r+=1)if(v.with(s[r]).equals(e))return!0}return!1}function At(s,t){const e=v.with(t);if(!e.multiple)return;s.merges||=[];const{merges:r}=s;r.length<=0||r.forEach((i,o)=>{v.with(i).within(e)&&r.splice(o,1)}),r.push(t)}function Ht({merges:s},t){if(s){for(let e=0;e<s.length;e+=1)if(s[e]===t){s.splice(e,1);return}}}function St({merges:s},t){if(s)for(let e=0;e<s.length;e+=1){const r=v.with(s[e]);r.intersects(t)&&(t=r.union(t))}return t}function Tt(s,t,e){let r=0;for(let i=s;i<t;i+=1)r+=e(i);return r}function wt(s,t){const e=Object.keys(s);if(e.length!==Object.keys(t).length)return!1;for(let r=0;r<e.length;r+=1){const i=e[r],o=s[i],n=t[i];if(n===void 0)return!1;if(typeof o=="string"||typeof o=="number"||typeof o=="boolean"){if(o!==n)return!1}else if(Array.isArray(o)){if(o.length!==n.length)return!1;for(let l=0;l<o.length;l+=1)if(!wt(o[l],n[l]))return!1}else if(typeof o!="function"&&!Array.isArray(o)&&o instanceof Object&&!wt(o,n))return!1}return!0}function ne(s){return s<=.75?1:s<=1.5?2:s<=2.25?3:s<=3?4:s<=3.75?5:s<=4.5?6:96/72*s}function $t(s,t){if(s.styles||(s.styles=[]),t)for(let e=0;e<s.styles.length;e+=1){const r=s.styles[e];if(wt(r,t))return e}return s.styles.push(t)-1}function le(s,t,e=!0){const r=s.styles[t];return e?Object.assign({},s.style,s.styles[t]||{}):r}function he(s){s.styles.length=0}function ae(s,t){s.borders||(s.borders=[]);const e=v.with(t[0]),{borders:r}=s;for(let i=0;i<r.length;i+=1){const[o,...n]=r[i],l=v.with(o);if(l.intersects(e)){l.within(e)||(r.push(t),l.difference(e).forEach(h=>{r.push([h.toString(),...n])})),r.splice(i,1);return}else if(n.every((h,a)=>h===t[a+1])&&l.touches(e)){r[i][0]=l.union(e).toString();return}}r.push(t)}function ce(s,t){const{borders:e}=s;if(e){const r=[],i=v.with(t);for(let o=0;o<e.length;o+=1){const[n,...l]=e[o],h=v.with(n);h.intersects(i)&&(h.within(i)||h.difference(i).forEach(a=>{r.push([a.toString(),...l])}),e.splice(o,1),o-=1)}e.push(...r)}}function fe(s){s.borders.length=0}function X(s,t,e){const r=s.cols[t]||{width:s.colWidth};return e?s.cols[t]=Object.assign(r,e):r}function rt(s,t,e){if(e){const{cols:r}=s;r[t]?r[t].width=e:r[t]={width:e}}else{const r=X(s,t);return r.hide?0:r.width}}function Et(s,t,e){const{cols:r}=s;if(arguments.length===1){let i=r.len*s.colWidth;for(let o in r)if(o!=="len"){const n=rt(s,parseInt(o,10));n>0&&(i+=n,i-=s.colWidth)}return i}return Tt(t!==void 0?t:0,e!==void 0?e:r.len,i=>rt(s,i))}function ue(s,t){return s.cols.len-1===t}function st(s,t,e){for(;;)if(X(s,t).hide)t+=e;else return t}function Y(s,t,e){const r=s.rows[t]||{height:s.rowHeight};return e?s.rows[t]=Object.assign(r,e):r}function it(s,t,e){if(e){const{rows:r}=s;r[t]?r[t].height=e:r[t]={height:e}}else{const r=Y(s,t);return r.hide?0:r.height}}function Wt(s,t,e){const{rows:r}=s;if(arguments.length===1){let i=r.len*s.rowHeight;for(let o in r)if(o!=="len"){const n=it(s,parseInt(o,10));n>0&&(i+=n,i-=s.rowHeight)}return i}return Tt(t!==void 0?t:0,e!==void 0?e:r.len,i=>it(s,i))}function de(s,t){return s.rows.len-1===t}function ot(s,t,e){for(;;)if(Y(s,t).hide)t+=e;else return t}function we(s,t,e=!1){if(!s||!t)return;const r=s.range.position(t.range);if(r==="none")return;const{rows:i,cols:o}=s.range;t.range.each((n,l)=>{let h=s.range.startRow,a=s.range.startCol,c,d,u=[n-t.range.startRow,l-t.range.startCol];["up","left"].includes(r)&&(u=[t.range.endRow-n,t.range.endCol-l]),r==="down"||r==="up"?i<=0&&e&&(c=r,d=u[0]+1,r==="up"&&(d=0-d)):o<=0&&e&&(c=r,d=u[1]+1,r==="left"&&(d=0-d));let w=u[1]%(o+1),f=u[0]%(i+1);["up","left"].includes(r)?(h=s.range.endRow-f,a=s.range.endCol-w):(h+=f,a+=w),_e(h,a,n,l,s,t,c,d)})}function _e(s,t,e,r,i,o,n,l){let h=i.cells.get(s,t);if(h!==null&&h[2]!==void 0&&h[2]!==null){let a=h[2];if(a instanceof Object){if(a=Object.assign({},a),a.style!==void 0&&i.cells!==o.cells){const c=Object.assign({},i.data.styles[a.style]);a.style=$t(o.data,c)}n!==void 0&&l!==void 0&&(a.formula?a.formula=a.formula.replace(/[a-zA-Z]{1,3}\d+/g,c=>["left","top"].includes(n)?Rt(c,l,0):Rt(c,0,l)):a.value&&(a.value=zt(a.value,l)))}else l!==void 0&&(a=zt(a,l));o.cells.set(e,r,a)}else o.cells.remove(s,t)}function zt(s,t){return typeof s=="string"?s.replace(/([0-9]+$)|(([0-9]+)[^0-9]+$)/g,e=>e.replace(/[0-9]+/,r=>`${parseInt(r)+t}`)):s+t}function ge(){return{rows:{len:100},cols:{len:26},rowHeight:25,colWidth:100,scroll:[0,0,0,0],style:{color:"#333",align:"left",valign:"middle",textwrap:!1,bold:!1,italic:!1,fontFamily:"Roboto",fontSize:10,underline:!1,strikethrough:!1},styles:[],borders:[],merges:[],cells:[]}}function nt(s,t,e){s.addEventListener(t,e)}function lt(s,t,e){s.removeEventListener(t,e)}function pe(s,t,e){const r=i=>{e(i),lt(s,"mousemove",t),lt(s,"mouseup",r)};nt(s,"mousemove",t),nt(s,"mouseup",r)}class Re{_events=new Map;on(t,e){const{_events:r}=this;return r.has(t)||r.set(t,[]),r.get(t).push(e),this}off(t,e){const{_events:r}=this;if(r.has(t)){const i=r.get(t);if(e){const o=i.findIndex(n=>n===e);o!==-1&&i.splice(o,1)}else i.length=0}return this}emit(t,...e){const{_events:r}=this;return r.has(t)&&r.get(t).forEach(i=>i(...e)),this}}class Ot{_;_hover;_line;_type;_minValue;_lineLength;_cell=null;_change;constructor(t,e,r,i,o=()=>{}){this._type=t,this._minValue=r,this._lineLength=i,this._change=o,this._=z("div",`${P}-resizer ${t}`).append(this._hover=z("div","hover").on("mousedown",n=>{n.stopPropagation(),ye(this,n)}),this._line=z("div","line")),e.append(this._)}show(t){this._cell=t;const{_type:e}=this,{x:r,y:i,width:o,height:n}=t;this._.css("left",`${e==="row"?r:r+o-5}px`).css("top",`${e==="row"?i+n-5:i}px`).show();const l=e==="row"?"width":"height";this._hover.css(l,`${t[l]}px`),this._line.css(l,`${this._lineLength()}px`)}hide(){this._.hide()}}function ye(s,t){const{_type:e,_cell:r,_minValue:i,_:o,_line:n,_change:l}=s;let h=0;n.show();const a=d=>{t!==null&&d.buttons===1&&r&&(e==="row"?(h+=d.movementY,h+r.height>=i?o.css("top",`${r.y+r.height+h}px`):h=i-r.height):(h+=d.movementX,h+r.width>=i?o.css("left",`${r.x+r.width+h}px`):h=i-r.width))},c=()=>{lt(window,"mousemove",a),lt(window,"mouseup",c),n.hide(),o.hide(),r&&h!=0&&l(h,r)};nt(window,"mousemove",a),nt(window,"mouseup",c)}class F{_;_rect=null;_target=null;constructor(t,e=!1){this._=z("div",`${P}-${t}`),e&&this.show()}append(t){return this._.append(t),this}offset(){if(this._rect&&this._target){const t=this._target.offset(),{x:e,y:r,width:i,height:o}=this._rect;return{x:e+t.x,y:r+t.y,width:i,height:o}}return null}rect(t){return this._rect=t,this._.css({left:t.x,top:t.y,width:t.width,height:t.height}),this}target(t,e=!0){return e&&t.append(this._),this._target=t,this}show(){return this._.show(),this}clear(){const{_target:t,_:e}=this;t&&(t.remove(e),this._target=null)}}class Ce{_placement="body";_editable=!1;_ranges=[];_rowHeaderRanges=[];_colHeaderRanges=[];_areas=[];_focus=[0,0];_focusRange=null;_focusArea=null;_move=[0,0];_copyRange=null;_copyAreas=[];_autofillRange=null;_autofillAreas=[];_autofillTrigger=t=>{};constructor(t){this._editable=t}get currentRange(){return this._ranges.at(-1)}placement(t){return this._placement=t,this}focus(t,e,r){return this._focus=[t,e],this._focusRange=r,this._move=[t,e],this}move(t,e){return this._move=[t,e],this}autofillRange(t){return this._autofillRange=t,this}autofillTrigger(t){return this._autofillTrigger=t,this}addRange(t,e=!0){return e&&(this._ranges.length=0,this.clear()),this._ranges.push(t),kt(this),this}updateLastRange(t){const{_focusRange:e}=this;e&&(this._ranges.splice(-1,1,t(e)),kt(this))}addAreaOutline(t,e){const r=new F("selector",!0).rect(_t(t,2)).target(e);this._placement==="body"&&r.append(z("div","corner").attr("draggable","false").on("mousedown",this._autofillTrigger)),this._areas.push(r)}addArea(t,e){return this._areas.push(new F("selector-area",!0).rect(t).target(e)),this}addRowHeaderArea(t,e){return this._areas.push(new F("selector-area row-header",!0).rect(t).target(e)),this}addColHeaderArea(t,e){return this._areas.push(new F("selector-area col-header",!0).rect(t).target(e)),this}addCopyArea(t,e){return this._copyAreas.push(new F("selector-copy",!0).rect(_t(t,2)).target(e)),this}addAutofillArea(t,e){return this._autofillAreas.push(new F("selector-autofill",!0).rect(_t(t,2)).target(e)),this}setFocusArea(t,e){return this._focusArea=new F("",!0).rect(t).target(e,!1),this}showCopy(){this._copyRange=this.currentRange}clearCopy(){this._copyRange=null,this._copyAreas.forEach(t=>{t.clear()}),this._copyAreas.length=0}clear(){[this._areas,this._autofillAreas,this._copyAreas].forEach(t=>{t.forEach(e=>e.clear()),t.length=0})}}function It(s,t,e){s.sort(t);let r=s[0];const i=[];s.length===1&&i.push(r);for(let o=1;o<s.length;o+=1){const n=s[o];e(r,n)?r=r.union(n):(i.push(r),r=n)}return s.length>1&&i.push(r),i}function kt(s){const t=[],e=[];for(let r of s._ranges)if(r){const{startRow:i,startCol:o,endRow:n,endCol:l}=r;(i>=0||n>=0)&&t.push(v.create(i,0,n,0)),(o>=0||l>=0)&&e.push(v.create(0,o,0,l))}s._rowHeaderRanges=It(t,(r,i)=>r.startRow-i.startRow,(r,i)=>r.intersectsRow(i.startRow,i.endRow)),s._colHeaderRanges=It(e,(r,i)=>r.startCol-i.startCol,(r,i)=>r.intersectsCol(i.startCol,i.endCol))}function _t(s,t){return{x:s.x-t/2,y:s.y-t/2,width:s.width-t,height:s.height-t}}const me={vertical:"height",horizontal:"width"};class Mt{_;_content;_value=0;_maxValue=0;_lastOffset=0;_type;_change=null;constructor(t,e){this._type=t,this._content=z("div","content"),this._=z("div",`${P}-scrollbar ${t}`).append(this._content).on("scroll",r=>{r.stopPropagation();const{scrollTop:i,scrollLeft:o}=r.target;if(this._change){const n=t==="vertical"?i:o,l=n>this._value?"+":"-";this._change(l,n,r),this._value=n}}),e.append(this._)}get value(){return this._value}change(t){return this._change=t,this}scrollBy(t){return t&&this.scroll(this._value+t),this}scrollToStart(){return this.scroll(0),this}scrollToEnd(){return this.scroll(this._maxValue),this}scroll(t){const{_:e,_type:r,_maxValue:i}=this;return t!==void 0?(t<0?t=0:t>i&&(t=i),r==="vertical"?e.scrolly(t):e.scrollx(t),this):r==="vertical"?e.scrolly():e.scrollx()}resize(t,e){if(e>t-1){const r=me[this._type];this._content.css(r,`${e}px`),this._.css(r,`${t}px`).show(),this._maxValue=e-t}else this._.hide();return this}}function be(s,t){let e="text";t instanceof Object&&t.type&&(e=t.type);const{_editors:r}=s,i=r.get(e);return i!==void 0&&(i.changer(o=>{o!==null&&$.setCellValue(s,o)}),i.moveChanger(o=>{const{_selector:n}=s;o!=="none"&&n&&($.move(s,!0,o,1),s._canvas.focus())})),i}function ve(s){const{_editor:t,_selector:e,_renderer:r}=s;if(t&&e){const{_focusArea:i,_focus:o}=e;if(t.visible&&i){const{_rect:n,_target:l}=i,{viewport:h}=r;n&&l&&h&&h.inAreas(...o)?t.rect(n).target(l).show():t.rect({x:-100,y:-100,width:0,height:0}).hide()}}}function xe(s){const{_selector:t}=s;if(t){const{_focusRange:e,_focusArea:r}=t;if(e&&r){const{_rect:i,_target:o}=r,{startRow:n,startCol:l}=e,h=s.cell(n,l),a=be(s,h);a!=null&&(s._editor=a,a&&i&&o&&(h&&a.value(h),a.cellIndex(n,l).rect(i).target(o).show()))}}}const ht={move:ve,reset:xe};function Ae(s){s._vScrollbar=new Mt("vertical",s._container).change((t,e)=>{oe(s._data,t,e)&&(s.render(),$.reset(s),ht.move(s))}),s._hScrollbar=new Mt("horizontal",s._container).change((t,e)=>{ie(s._data,t,e)&&(s.render(),$.reset(s),ht.move(s))})}function He(s){const{x:t,y:e,height:r,width:i}=s._contentRect;s._vScrollbar&&s._vScrollbar.resize(s._height(),r+e),s._hScrollbar&&s._hScrollbar.resize(s._width(),i+t)}function Se(s,t,e){if(!t)return;const{_selector:r,_vScrollbar:i,_hScrollbar:o,_data:n}=s,{viewport:l}=s._renderer;if(l&&r){const[,h,,a]=l.areas,c=a.range,d=h.range;if(i){const u=(w,f,_)=>{const C=s.rowsHeight(f,_+1);let R=0;for(let p=w;R<C;p+=1)R+=s.rowHeight(p);return R};e?t.endRow===e.endRow?t.startRow<e.startRow?t.startRow>d.endRow&&t.startRow<c.startRow&&i.scrollBy(-s.rowsHeight(t.startRow,c.startRow)):t.startRow>e.startRow&&t.startRow>=c.endRow&&i.scrollBy(u(c.startRow,c.endRow,t.startRow)):t.startRow===e.startRow&&(t.endRow>e.endRow?t.endRow>=c.endRow&&i.scrollBy(u(c.startRow,c.endRow,t.endRow)):t.endRow<e.endRow&&t.endRow<c.startRow&&i.scrollBy(-s.rowsHeight(t.endRow,c.startRow))):t.endRow===n.rows.len-1?i.scrollToEnd():t.startRow===0?i.scrollToStart():t.endRow>=c.endRow?i.scrollBy(u(c.startRow,c.endRow,t.endRow)):t.startRow>d.endRow&&t.startRow<c.startRow&&i.scrollBy(-s.rowsHeight(t.startRow,c.startRow))}if(o){const u=(w,f,_)=>{const C=s.colsWidth(f,_+1);let R=0;for(let p=w;R<C;p+=1)R+=s.colWidth(p);return R};e?t.endCol===e.endCol?t.startCol<e.startCol?t.startCol>d.endCol&&t.startCol<c.startCol&&o.scrollBy(-s.colsWidth(t.startCol,c.startCol)):t.startCol>e.startCol&&t.startCol>=c.endCol&&o.scrollBy(u(c.startCol,c.endCol,t.startCol)):t.startCol===e.startCol&&(t.endCol>e.endCol?t.endCol>=c.endCol&&o.scrollBy(u(c.startCol,c.endCol,t.endCol)):t.endCol<e.endCol&&t.endCol<c.startCol&&o.scrollBy(-s.colsWidth(t.endCol,c.startCol))):t.endCol===n.cols.len-1?o.scrollToEnd():t.startCol===0?o.scrollToStart():t.endCol>=c.endCol?o.scrollBy(u(c.startCol,c.endCol,t.endCol)):t.startCol>d.endCol&&t.startCol<c.startCol&&o.scrollBy(-s.colsWidth(t.startCol,c.startCol))}}}const N={init:Ae,resize:He,autoMove:Se};function Te(s){s._selector=new Ce(!!s._editable).autofillTrigger(t=>{const{_selector:e}=s;e&&Lt(s,(r,i)=>{const{currentRange:o}=e;if(o){const n=o.clone();if(n.contains(r,i))e.autofillRange(null);else{const l=[n.startRow-r,r-n.endRow,n.startCol-i,i-n.endCol],h=l.indexOf(Math.max.apply(null,l));h===1?(n.startRow=n.endRow+1,n.endRow=r):h===0?(n.endRow=n.startRow-1,n.startRow=r):h===3?(n.startCol=n.endCol+1,n.endCol=i):h===2&&(n.endCol=n.startCol-1,n.startCol=i),e.autofillRange(n)}}},r=>r._autofillRange,r=>{s.copy(r._autofillRange,!0).render(),e.autofillRange(null),K(s)})})}function $e(s,t){const{_selector:e}=s;if(e){e.clearCopy();const{_ranges:r}=e;r.forEach(i=>{i&&i.each((o,n)=>{s.cell(o,n,t)})}),s.render()}}function Pt(s,t,e,r){const{_selector:i,_data:o}=s,n=v.create(t,e),l=St(o,n);i&&i.focus(t,e,l).addRange(i._placement==="body"?l:n,r)}function jt(s,t,e){const{_selector:r,_data:i}=s;r&&r.move(t,e).updateLastRange(o=>St(i,o.union(v.create(t,e))))}function K(s){const{_selector:t,_overlayer:e}=s,{_rowHeader:r,_colHeader:i,viewport:o}=s._renderer;if(t&&o){const{_placement:n}=t;t.clear();const l=r.width,h=i.height,a=(u,w)=>{const f=u.clone();return(n==="all"||n==="row-header")&&(f.endCol=w.endCol,u.startCol<w.startCol&&(f.startCol=w.startCol)),(n==="all"||n==="col-header")&&(f.endRow=w.endRow,u.startRow<w.startRow&&(f.startRow=w.startRow)),f},c=({range:u},w)=>n==="body"?u.intersects(w):n==="col-header"?u.intersectsCol(w.startCol,w.endCol):n==="row-header"?u.intersectsRow(w.startRow,w.endRow):!0,d=(u,w,f)=>{let _=u.rect(w);return n==="col-header"?(_=u.rectCol(w.startCol,w.endCol),_.height+=2,(f===2||f===3)&&(_.y-=2)):n==="row-header"&&(_=u.rectRow(w.startRow,w.endRow),_.width+=2,(f===0||f===3)&&(_.x-=2)),_};o.areas.forEach((u,w)=>{const f=e._areas[w],{_ranges:_,_focusRange:C,_copyRange:R,_autofillRange:p}=t;_.forEach((A,m)=>{let y=c(u,A),x=d(u,A,w);if(y)if(m===_.length-1){if((n!=="all"||u.range.intersects(A))&&t.addAreaOutline(x,f),C){u.range.intersects(C)&&t.setFocusArea(u.rect(C),f);const H=a(A,u.range),b=H.difference(C);b.length>0?b.forEach(S=>{y=c(u,S),y&&t.addArea(u.rect(S),f)}):(n!=="body"||!A.equals(C))&&t.addArea(d(u,H,w),f)}}else t.addArea(x,f)}),R&&u.range.intersects(R)&&t.addCopyArea(u.rect(R),f),p&&u.range.intersects(p)&&t.addAutofillArea(u.rect(p),f)}),o.headerAreas.forEach((u,w)=>{const f=e._headerAreas[w],{width:_,height:C}=u;w<=1?n==="row-header"||n==="all"?t.addColHeaderArea({x:0,y:0,width:_,height:h},f):t._colHeaderRanges.forEach(R=>{u.range.intersectsCol(R.startCol,R.endCol)&&t.addColHeaderArea(u.rectCol(R.startCol,R.endCol),f)}):n==="col-header"||n==="all"?t.addRowHeaderArea({x:0,y:0,width:l,height:C},f):t._rowHeaderRanges.forEach(R=>{u.range.intersectsRow(R.startRow,R.endRow)&&t.addRowHeaderArea(u.rectRow(R.startRow,R.endRow),f)})})}}function Ee(s,t){const{_selector:e,_data:r}=s;if(e){const i=e._autofillRange;if(i)return t==="up"?i.startRow=ot(r,i.startRow-1,-1):t==="down"?i.endRow=ot(r,i.endRow+1,1):t==="left"?i.startCol=st(r,i.startCol-1,-1):t==="right"&&(i.endCol=st(r,i.endCol+1,1)),N.autoMove(s,i),K(s),!0}return!1}function gt(s,t,e,r){if(Ee(s,e))return;const{_selector:i,_data:o}=s,{viewport:n}=s._renderer;if(i&&n){const{_focusRange:l}=i;if(l){let{startRow:h,startCol:a,endRow:c,endCol:d}=l;const{rows:u,cols:w}=o;let[f,_]=i._move;t||(h=c=f,a=d=_);const C=i.currentRange?.clone();r?e==="up"?f=ot(o,h-r,-1):e==="down"?f=ot(o,c+r,1):e==="left"?_=st(o,a-r,-1):e==="right"&&(_=st(o,d+r,1)):e==="up"?f=0:e==="down"?f=u.len-1:e==="left"?_=0:e==="right"&&(_=w.len-1),f>=0&&f<=u.len-1&&_>=0&&_<=w.len-1&&(t?Pt(s,f,_,!0):(jt(s,f,_),i._move=[f,_])),i.placement("body"),N.autoMove(s,i.currentRange,t?void 0:C),K(s)}}}function Lt(s,t,e,r=i=>{}){const{_selector:i,_renderer:o}=s;if(!i)return;const{_placement:n}=i,l={row:0,col:0};if(n!=="all"){const{left:h,top:a}=s._canvas.rect();let c=[0,0],d=null;const u=()=>{d!==null&&(clearInterval(d),d=null)};pe(window,f=>{let[_,C]=[0,0];f.x>0&&(_=f.x-h),f.y>0&&(C=f.y-a),n==="row-header"&&(_=1),n==="col-header"&&(C=1);const R=i.currentRange?.clone(),{target:p}=f;if(p.tagName==="CANVAS"){const A=o.viewport?.cellAt(_,C);if(A){let{row:m,col:y}=A;(m!=l.row||y!==l.col)&&(t(m,y),n==="body"&&N.autoMove(s,e(i),R),K(s),l.row=m,l.col=y)}u()}else if(d===null){const A=f.x-c[0],m=f.y-c[1];A>=0&&m>=0&&(d=setInterval(()=>{const y=e(i);if(y){const{endRow:x,endCol:H}=y;A>m?(gt(s,!1,"right",1),s.isLastRow(x)&&u()):(gt(s,!1,"down",1),s.isLastCol(H)&&u())}},120))}c=[f.x,f.y]},()=>{u(),r(i)})}}function We(s){s._selector&&(s._selector.showCopy(),K(s))}function ze(s){s._selector&&(s._selector.clearCopy(),K(s))}const $={init:Te,setCellValue:$e,addRange:Pt,unionRange:jt,reset:K,move:gt,bindMousemove:Lt,showCopy:We,clearCopy:ze};function Oe(s){s._rowResizer=new Ot("row",s._container,s._minRowHeight,()=>s._width(),(t,{row:e,height:r})=>{s.rowHeight(e,r+t).render(),$.reset(s),s._canvas.focus()}),s._colResizer=new Ot("col",s._container,s._minColWidth,()=>s._height(),(t,{col:e,width:r})=>{s.colWidth(e,r+t).render(),$.reset(s),s._canvas.focus()})}const Ie={init:Oe};function ke(s){s._canvas.on("mousedown",t=>Me(s,t)).on("mousemove",t=>Pe(s,t)).on("keydown",t=>Be(s,t)).on("wheel",t=>je(s,t)).on("contextmenu",t=>Le(s,t)).on("dblclick",t=>{t.preventDefault(),ht.reset(s)})}function Me(s,t){const{_selector:e,_renderer:r,_editor:i,_emitter:o}=s,{viewport:n}=r;if(i&&i.changed(),e&&n){const{offsetX:l,offsetY:h,ctrlKey:a,metaKey:c,shiftKey:d}=t,u=n.cellAt(l,h);if(u){o.emit("click",u,t);const{placement:w,row:f,col:_}=u;d?$.unionRange(s,f,_):(e.placement(w),$.addRange(s,f,_,!(c||a)),w==="body"&&N.autoMove(s,e.currentRange)),$.reset(s),$.bindMousemove(s,(C,R)=>{$.unionRange(s,C,R)},C=>C.currentRange)}}}function Pe(s,t){const{_rowResizer:e,_colResizer:r,_renderer:i}=s,{viewport:o}=i,{buttons:n,offsetX:l,offsetY:h}=t;if(o&&n===0){const{_rowHeader:a,_colHeader:c}=s._renderer;if(e&&a.width>0)if(l<a.width&&h>c.height){const d=o.cellAt(l,h);d&&e.show(d)}else e.hide();if(r&&c.height>0)if(h<c.height&&l>a.width){const d=o.cellAt(l,h);d&&r.show(d)}else r.hide()}}function je(s,t){t.preventDefault();const{deltaX:e,deltaY:r}=t,{_hScrollbar:i,_vScrollbar:o}=s;Math.abs(e)>Math.abs(r)?i&&i.scrollBy(e):o&&o.scrollBy(r)}function Le(s,t){t.preventDefault();const{_renderer:e,_editor:r,_emitter:i}=s,{viewport:o}=e;if(r&&r.changed(),o){const{offsetX:n,offsetY:l}=t,h=o.cellAt(n,l);i.emit("contextmenu",h,t)}}function Be(s,t){const{ctrlKey:e,shiftKey:r,metaKey:i,altKey:o,code:n}=t;let l=null;if(n==="Enter"&&!e&&!i&&!o)r?l="up":l="down";else if(n==="Tab"&&!e&&!i&&!o)r?l="left":l="right";else if(n.startsWith("Arrow"))l=n.substring(5).toLowerCase();else if(!e&&!i&&!o&&(n.startsWith("Key")||n.startsWith("Digit")||["Minus","Equal","Space","BracketLeft","BracketRight","Backslash","Semicolon","Quote","Comma","Period","Slash"].includes(n)))ht.reset(s),t.preventDefault();else if(n==="KeyC"&&(e||i)){const{_selector:h}=s;if(s._copyable&&h){const a={},c=h.currentRange;c&&($.showCopy(s),["text/plain","text/html"].forEach(d=>{const u=c.toString(),w=d==="text/html"?s.toHtml(u):Ve(s,u);a[d]=new Blob([w],{type:d})}),navigator.clipboard.write([new ClipboardItem(a)]).then(()=>console.log("clipboard has writed success"),d=>console.log("clipboard has wirted failure: ",d)))}}else n==="KeyV"&&(e||i)?s._editable&&navigator.clipboard.read().then(h=>{if(h.length>0){const a=h[0];let c=r;c||(c=!Bt(a,"text/html",d=>{s.fill(d).render()})),c&&Bt(a,"text/plain",d=>{s.fill(De(d)).render()})}}):n==="Escape"&&$.clearCopy(s);l&&($.move(s,!(n.startsWith("Arrow")&&r),l,i||e?void 0:1),t.preventDefault())}function Ve(s,t){const e=v.with(t);let r="";return e.eachRow(i=>{e.eachCol(o=>{let n=s.cellValueString(i,o);n.includes(`
`)&&(n=`"${n}"`),r+=`${n}	`}),r+=`
`}),r}function De(s){const t=[];let[e,r]=[0,0],i="",o=0;const n=()=>{t[e]||=[],t[e][r]=i,i=""};for(let l of s){if(l==="	"){n(),r+=1,o=0;continue}if(l===`
`&&o!==1){n(),e+=1,r=0;continue}l!=='"'?l!=="\r"&&(i+=l):o+=1}return r>0&&n(),t.length<=0&&t.push([s]),t}function Bt(s,t,e=r=>{}){return s.types.includes(t)?(s.getType(t).then(r=>{r.text().then(i=>{e(i)})}),!0):!1}function Fe(s,t){let e='<table xmlns="http://www.w3.org/1999/xhtml" style="border-spacing: 0; border-collapse: collapse;">';const r=v.with(t),i=s._data.merges.map(l=>v.with(l)).filter(l=>l.intersects(r)),o=(l,h)=>l==="dashed"||l==="dotted"?`1px ${l} ${h}`:`${l==="thick"?3:l==="medium"?2:1}px solid ${h}`,n=new Map;for(let l of s._data.borders){const[h,a,c,d]=l,u=v.with(h);if(u.intersects(r)){const{startRow:w,startCol:f,endRow:_,endCol:C}=u;u.each((R,p)=>{const A=o(c,d);let m=[];a==="all"&&m.push("border"),(a==="outside"||a==="left")&&p===f&&m.push("border-left"),(a==="outside"||a==="right")&&p===C&&m.push("border-right"),(a==="outside"||a==="top")&&R===w&&m.push("border-top"),(a==="outside"||a==="bottom")&&R===_&&m.push("border-bottom"),(a==="inside"||a==="vertical")&&p>=f&&p<C&&m.push("border-right"),(a==="inside"||a==="horizontal")&&R>=w&&R<_&&m.push("border-bottom"),m.length>0&&n.set(`${R}_${p}`,m.map(y=>`${y}:${A};`).join(""))})}}return e+="<colgroup>",r.eachCol(l=>{e+=`<col width="${s.colWidth(l)}"/>`}),e+="</colgroup>",e+="<tbody>",r.eachRow(l=>{e+=`<tr style="height: ${s.rowHeight(l)}px;">`,r.eachCol(h=>{const a=s.cell(l,h),c=v.create(l,h);let d=!1,[u,w]=[1,1];for(let f of i){if(f.startRow===l&&f.startCol===h){u=f.rows+1,w=f.cols+1;break}if(f.intersects(c)){d=!0;break}}if(!d){e+="<td",u>1&&(e+=` rowspan="${u}"`),w>1&&(e+=` colspan="${w}"`);let f="";const _=`${l}_${h}`;n.has(_)&&(f+=n.get(_)),a&&a instanceof Object&&a.style!==void 0&&(f+=Ge(s.style(a.style,!0))),f!==""&&(e+=` style="${f}"`),e+=`>${s.cellValueString(l,h)}</td>`}}),e+="</tr>"}),e+"</tbody></table>"}function Ke(s,t,[e,r]){const i=[0,0];if(t&&t.includes("</table>")){const{_data:o}=s,n=o.style,l=document.createElement("template");l.innerHTML=t;const h=[],a=l.content.querySelectorAll("tr");i[0]=e+a.length-1;const c=[];if(a.forEach((d,u)=>{const w=d.querySelectorAll("td");u===0&&(i[1]=r+w.length-1);let f=null;const _=[];for(let R=0;R<w.length;R+=1){const p=w[R];let[A,m]=[u+e,R+r];h.length>0&&h.forEach(g=>{g.containsRow(A)&&g.startCol<=m&&(m+=g.cols,g.startRow!==A&&(m+=1))});const y=tt(m,A);let[x,H]=[1,1];if(Vt(p,"rowspan",g=>x=parseInt(g)),Vt(p,"colspan",g=>H=parseInt(g)),x>1||H>1){const g=v.create(A,m,A+x-1,m+H-1);s.merge(g.toString()),h.push(g)}u===0&&(i[1]+=H-1);const b={};I(p,"background-color","",g=>b.bgcolor=g),I(p,"color",n.color,g=>b.color=g),I(p,"text-align",n.align,g=>b.align=g),I(p,"vertical-align",n.valign,g=>b.valign=g),at(p,"white-space","normal",g=>b.textwrap=!0),at(p,"text-decoration","underline",g=>b.underline=!0),at(p,"text-decoration","line-through",g=>b.strikethrough=!0),at(p,"font-style","italic",g=>b.italic=!0),I(p,"font-weight","normal",g=>{(g==="bold"||parseInt(g)>=700)&&(b.bold=!0)}),I(p,"font-family",n.fontFamily,g=>b.fontFamily=g),I(p,"font-size",n.fontSize,g=>b.fontSize=parseInt(g));const S=g=>{const[M,T,...Q]=g.split(" ").map(J=>J.trim());let ct="thin";if(T==="solid"){let J=parseInt(M);M.includes("pt")&&(J=ne(parseInt(M))),J===2?ct="medium":J===3&&(ct="thick")}else ct=T;return[ct,Q.join("")]};let W=[],E=null;I(p,"border-width","",g=>W.push(g)),I(p,"border-style","",g=>W.push(g)),I(p,"border-color","",g=>W.push(g)),W.length>=3?E=[y,"all",...S(W.join(" "))]:I(p,"border","none",g=>E=[y,"all",...S(g)])||["top","right","bottom","left"].forEach(g=>{I(p,`border-${g}`,"none",M=>E=[y,g,...S(M)])}),f===null?E!==null&&(f=E):E!==null&&E[1]===f[1]&&E[2]===f[2]&&E[3]===f[3]?f[0]=`${f[0].split(":")[0]}:${y}`:(_.push(f),f=E);const k=p.innerHTML.replace(/<br(\/){0,1}>/gi,`
`).replace(/(<([^>]+)>|)/gi,"").replace("&nbsp;"," "),O={};Object.keys(b).length>0&&(O.style=s.addStyle(b)),k!==null&&!/^\s*$/.test(k)&&(O.value=k),Object.keys(O).length>0&&s.cell(A,m,O)}f!=null&&_.push(f);const C=c.at(-1);if(C&&C.length>0)if(C.length===1&&_.length===1&&C[0][1]==="all"&&C[0][1]===_[0][1]&&C[0][2]===_[0][2]&&C[0][3]===_[0][3]){const R=v.with(C[0][0]);R.endRow+=1,C[0][0]=R.toString()}else c.push(_);else c.push(_)}),c.length>0)for(let d of c)d.forEach(u=>s.addBorder(...u))}return i}function Vt(s,t,e){if(s.hasAttribute(t)){const r=s.getAttribute(t);r!=null&&e(r)}}function I(s,t,e,r){const i=s.style.getPropertyValue(t),o=i!==null&&i!==""&&i!==e;return o&&r(i),o}function at(s,t,e,r){const i=s.style.getPropertyValue(t);i===e&&r(i)}function Ge(s){let t="";return s.bgcolor&&(t+=`background-color: ${s.bgcolor};`),s.color&&(t+=`color: ${s.color};`),s.align&&(t+=`text-align: ${s.align};`),s.valign&&(t+=`vertical-align: ${s.valign};`),s.textwrap===!0&&(t+="white-space: normal;"),s.underline===!0&&(t+="text-decoration: underline;"),s.strikethrough===!0&&(t+="text-decoration: line-through;"),s.bold===!0&&(t+="font-weight: bold;"),s.italic===!0&&(t+="font-style: italic;"),s.fontFamily&&(t+=`font-family: ${s.fontFamily};`),s.fontSize&&(t+=`font-size: ${s.fontSize}pt;`),t}class qe{_;_target=null;_rect=null;_value;_visible=!1;_moveChanger=()=>{};_changer=()=>{};constructor(t){this._=z("div",t)}get visible(){return this._visible}target(t){return t.append(this._),this._target=t,this}cellIndex(t,e){return this}value(t){return this._value=t,this}changed(){this._changer(this._value),this.hide()}rect(t){if(t){this._visible=!0,this._rect=t;const{x:e,y:r,width:i,height:o}=t;this._.css({left:e-2/2,top:r-2/2,width:i-2,height:o-2}).show()}return this}show(){return this._.show(),this}hide(){return this._visible=!1,this.value(""),this._.hide(),this}moveChanger(t){return this._moveChanger=t,this}changer(t){return this._changer=t,this}}class Xe extends qe{_text=z("textarea","");_textMeasure=z("div","measure");_editing=!1;constructor(){super(`${P}-editor`),this._.append(this._text,this._textMeasure),this._text.on("keydown",t=>{Ye(this,t)}).on("input",({target:t})=>{const{value:e}=t;this._editing=!0,this._value=e,this._changer(e),Dt(this)})}value(t){return super.value(t),this._text.value(U(t)||""),Dt(this),this}rect(t){return super.rect(t),t&&setTimeout(()=>{const{_value:e}=this;let r=0;e!==null&&(r=U(e).length);const i=this._text.element();i.focus(),i.setSelectionRange(r,r)},0),this}hide(){return super.hide(),this._editing=!1,this}}function Dt(s){const{_:t,_value:e,_rect:r,_textMeasure:i,_target:o}=s;if(typeof e!="string")return;let n=e.replace(`
`,"<br/>");if(e.endsWith(`
`)&&(n+="T"),i.html(n),r&&o){const l=parseInt(i.computedStyle().getPropertyValue("padding")),h=o.offset(),a=h.width-r.x-2,c=h.height-r.y-2;t.css("max-width",`${a}px`),i.css("max-width",`${a-l*2}px`);const{width:d,height:u}=i.rect(),w=r.width-2;d>w&&t.css({width:d}),u>r.height&&u<=c?t.css({height:u}):u<r.height&&t.css({height:r.height-2})}}function Ye(s,t){const{code:e,shiftKey:r,metaKey:i,altKey:o,ctrlKey:n,target:l}=t,h=a=>{s._moveChanger(a),s.hide()};e==="Enter"?(n||i||o?(l.value+=`
`,s.value(l.value)):h(r?"up":"down"),t.preventDefault()):e==="Tab"&&!n&&!i&&!o&&(h(r?"left":"right"),t.preventDefault())}class Z{_rendererOptions={};_copyable=!1;_editable=!1;_minRowHeight=25;_minColWidth=60;_width;_height;_contentRect={x:0,y:0,width:0,height:0};_container;_data;_renderer;_cells=new se;_vScrollbar=null;_hScrollbar=null;_rowResizer=null;_colResizer=null;_editor=null;_editors=new Map;_selector=null;_overlayer;_canvas;_emitter=new Re;constructor(t,e,r,i){this._width=e,this._height=r;const o=typeof t=="string"?document.querySelector(t):t;if(o===null)throw new Error("first argument error");if(this._container=z(o,`${P}-container`).css({height:r(),width:e()}),this._data=ge(),i){const{minColWidth:l,minRowHeight:h,renderer:a,data:c}=i;if(l&&(this._minColWidth=l),h&&(this._minRowHeight=h),a&&(this._rendererOptions=a),c){const{cols:d,rows:u,rowHeight:w,colWidth:f}=c,{_data:_}=this;d&&(_.cols.len=d),u&&(_.rows.len=u),w&&(_.rowHeight=w),f&&(_.colWidth=f)}}const n=document.createElement("canvas");this._canvas=z(n).attr("tabIndex","1"),this._container.append(n),this._renderer=new et(n,e(),r()),this._overlayer=new Kt(this._container),Ft(this),i?.selectable&&$.init(this),i?.scrollable&&N.init(this),i?.resizable&&Ie.init(this),i?.editable&&(this._editable=!0),this._copyable=i?.copyable||!1,this._editors.set("text",new Xe),ke(this)}contentRect(){return this._contentRect}container(){return this._container}resize(){this._container.css({height:this._height(),width:this._width()}),this._renderer.width(this._width()),this._renderer.height(this._height()),this.render()}freeze(t){return this._data.freeze=t,this}isMerged(t){if(t)return xt(this._data,t);{const{_selector:e}=this;if(e)return e._ranges.every(r=>xt(this._data,r.toString()))}return!1}merge(t){if(t)At(this._data,t);else{const{_selector:e}=this;e&&e._ranges.forEach(r=>At(this._data,r.toString()))}return this}unmerge(t){if(t)Ht(this._data,t);else{const{_selector:e}=this;e&&e._ranges.forEach(r=>Ht(this._data,r.toString()))}return this}row(t,e){return e?(e.height&&this.rowHeight(t,e.height),Y(this._data,t,e),this):Y(this._data,t)}rowHeight(t,e){const r=it(this._data,t);return e?(r!==e&&(it(this._data,t,e),this._contentRect.height+=e-r),this):r}rowsHeight(t,e){return Wt(this._data,t,e)}isLastRow(t){return de(this._data,t)}col(t,e){return e?(e.width&&this.colWidth(t,e.width),X(this._data,t,e),this):X(this._data,t)}colWidth(t,e){const r=rt(this._data,t);return e?(r!==e&&(rt(this._data,t,e),this._contentRect.width+=e-r),this):r}colsWidth(t,e){return Et(this._data,t,e)}isLastCol(t){return ue(this._data,t)}formulaParser(t){return this._cells.formulaParser(t),this}formatter(t){return this._cells.formatter(t),this}style(t,e=!0){return le(this._data,t,e)}addStyle(t){return $t(this._data,t)}clearStyles(){return he(this._data),this}addBorder(...t){return ae(this._data,t),this}clearBorder(t){return ce(this._data,t),this}clearBorders(){return fe(this._data),this}cell(t,e,r){const{_cells:i}=this;if(r)return i.set(t,e,r),this;const o=i.get(t,e);return o!=null?o[2]:o}cellValue(t,e){return bt(this.cell(t,e))}cellValueString(t,e){return U(this.cell(t,e))}render(){const{_data:t,_renderer:e,_overlayer:r}=this;for(let o in this._rendererOptions){const n=this._rendererOptions[o];n&&e[o](n)}e.scrollRows(t.scroll[0]).scrollCols(t.scroll[1]).merges(t.merges).freeze(t.freeze).styles(t.styles).borders(t.borders).rows(t.rows.len).cols(t.cols.len).row(o=>Y(t,o)).col(o=>X(t,o)).cell((o,n)=>this.cell(o,n)).formatter(this._cells._formatter).render();const{viewport:i}=e;return i&&(i.areas.forEach((o,n)=>{r.area(n,o)}),i.headerAreas.forEach((o,n)=>{r.headerArea(n,o)}),N.resize(this)),this}data(t){return t?(Object.assign(this._data,t),this._cells.load(this._data),Ft(this),this):this._data}copy(t,e=!1){if(!t)return this;const r=(o,n)=>({range:typeof o=="string"?v.with(o):o,cells:n._cells,data:n._data}),i=o=>{const{_selector:n}=o;if(!n)return null;const l=n.currentRange;return l===void 0?null:r(l,o)};return we(i(this),t instanceof Z?i(t):r(t,this),e),this}fill(t,e){const{_selector:r}=this;let[i,o]=[0,0];if(e)[o,i]=q(e);else{if(!r)return this;[i,o]=r._focus}let[n,l]=[0,0];if(Array.isArray(t)){for(let h=0;h<t.length;h+=1){const a=t[h];l=o+a.length-1;for(let c=0;c<a.length;c+=1)this.cell(i+h,o+c,a[c])}n=i+t.length-1}else typeof t=="string"&&([n,l]=Ke(this,t,[i,o]));return(n>0||l>0)&&($.unionRange(this,n,l),$.reset(this)),this}toHtml(t){return Fe(this,t)}toArrays(t){const e=v.with(t),r=[];return e.eachRow(i=>{const o=[];e.eachCol(n=>{o.push(this.cellValue(i,n))}),r.push(o)}),r}on(t,e){return this._emitter.on(t,e),this}addEditor(t,e){return this._editors.set(t,e),this}static create(t,e,r,i){return new Z(t,e,r,i)}}function Ft(s){s._contentRect={x:s._renderer._rowHeader.width,y:s._renderer._colHeader.height,width:Et(s._data),height:Wt(s._data)}}window&&(window.tiny||={},window.tiny.table=Z.create),L.HElement=G,L.default=Z,L.h=z,Object.defineProperties(L,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
